#!/usr/bin/env ruby
require "fileutils"

APP_ROOT = File.expand_path("..", __dir__)

def system!(*args)
  system(*args, exception: true)
end

FileUtils.chdir APP_ROOT do
  puts ">>> Checking dependencies <<<"
  # Install Rails/Ruby dependencies
  system("bundle check > /dev/null") || system!("bundle install --quiet")
  # Install JavaScript dependencies
  system!("bun install --silent")
  puts "✅ Dependencies are in place"

  puts "\n>>> Running `erb-formatter` <<<"
  system("erb-format --write app/views/**/*.*.erb")
  puts "✅ ERB files look good"

  puts "\n>>> Formatting tailwind classes <<<"
  system("tailwindcss-format app/**/*.*.erb -w")
  puts "✅ Tailwind classes are sorted"

  puts "\n>>> Running `rubocop` <<<"
  exec "bin/rubocop -A"
  puts "✅ Formatting complete"
end
